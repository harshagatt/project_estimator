<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Development Estimator</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        /* Custom styles for the header to make it stand out - adapted for Bootstrap */
        .hero-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Original gradient */
            color: white;
            padding: 4rem 2rem; /* More padding */
            border-bottom-left-radius: 2rem; /* Rounded corners */
            border-bottom-right-radius: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Shadow */
            margin-bottom: 3rem; /* Spacing below header */
        }
        .hero-header h1 {
            font-size: 3.5rem; /* Larger font size for the title */
            margin-bottom: 1rem;
            font-weight: 800; /* Equivalent to font-extrabold */
        }
        .hero-header p {
            font-size: 1.25rem; /* Larger font size for lead text */
            opacity: 0.9;
            font-weight: 300; /* Equivalent to font-light */
        }
        .hero-header .author-info {
            margin-top: 1.5rem;
            font-size: 1rem;
            opacity: 0.8;
        }
        .hero-header .author-info a {
            color: #d1d5db; /* Light gray for link */
            text-decoration: underline;
        }
        .hero-header .author-info a:hover {
            color: #e5e7eb; /* Lighter gray on hover */
        }

        /* Existing Bootstrap-related styles */
        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 6px 15px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-weight: 600;
            padding: 1.5rem;
            border-radius: 1rem 1rem 0 0 !important;
        }
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 0.5rem;
        }
        .form-control, .form-select {
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid #e0e0e0;
        }
        .form-control:focus, .form-select:focus {
            border-color: #2575fc;
            box-shadow: 0 0 0 0.25rem rgba(37, 117, 252, 0.25);
        }
        .btn-primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(37, 117, 252, 0.4);
        }
        .result-card {
            border-left: 4px solid #2575fc;
        }
        .result-value {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .cost-value {
            color: #28a745;
        }
        .agile-value {
            color: #6f42c1;
        }
        .waterfall-value {
            color: #fd7e14;
        }
        .history-item {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        .history-item:hover {
            transform: translateX(5px);
            border-left: 3px solid #2575fc;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="hero-header text-center w-100">
        <div class="container">
            <h1 class="text-white">Software Development Estimator</h1>
            <p class="mb-0">Get accurate estimates for your software projects using AI.</p>
            <div class="author-info">
                By Harsha GS | <a href="https://github.com/harshagatt" target="_blank" rel="noopener noreferrer">github.com/harshagatt</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Estimation Form -->
        <div class="card mb-4">
            <div class="card-header d-flex align-items-center">
                <i class="bi bi-clipboard2-plus-fill me-2"></i>
                <h2 class="h5 mb-0">Enter Project Requirements</h2>
            </div>
            <div class="card-body">
                <form id="estimationForm" class="row g-3">
                    <div class="col-md-12">
                        <label for="projectName" class="form-label">Project Name</label>
                        <input type="text" class="form-control" id="projectName" placeholder="e.g., E-commerce Platform" required>
                    </div>
                    <div class="col-md-12">
                        <label for="description" class="form-label">Project Description</label>
                        <textarea class="form-control" id="description" rows="3" placeholder="Briefly describe the project's purpose and scope." required></textarea>
                    </div>
                    <div class="col-md-12">
                        <label for="features" class="form-label">Key Features / Requirements</label>
                        <textarea class="form-control" id="features" rows="5" placeholder="List key features or user stories, one per line or separated by commas." required></textarea>
                    </div>
                    <div class="col-md-12">
                        <label for="technologies" class="form-label">Technologies Involved (Optional)</label>
                        <input type="text" class="form-control" id="technologies" placeholder="e.g., React, Python, Flask, MongoDB, AWS">
                    </div>
                    <div class="col-md-12">
                        <label for="notes" class="form-label">Additional Notes (Optional)</label>
                        <textarea class="form-control" id="notes" rows="2" placeholder="Any other relevant details, constraints, or assumptions."></textarea>
                    </div>
                    <div class="col-12 text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            <i class="bi bi-lightning-charge-fill me-2"></i>Get Estimate
                        </button>
                    </div>
                </form>
                <div id="loadingMessage" class="text-center mt-4 text-primary fw-medium d-none">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    Estimating... This may take a moment.
                </div>
            </div>
        </div>

        <!-- Estimation Results -->
        <div id="results" class="card mb-4 d-none">
            <div class="card-header d-flex align-items-center">
                <i class="bi bi-graph-up me-2"></i>
                <h2 class="h5 mb-0">Estimation Results for <span id="resultProjectName" class="text-primary"></span></h2>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded-3 h-100">
                            <h3 class="h6 text-muted mb-2"><i class="bi bi-currency-dollar me-2"></i>Total Estimated Cost</h3>
                            <p id="costEstimate" class="result-value cost-value mb-0">-</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded-3 h-100">
                            <h3 class="h6 text-muted mb-2"><i class="bi bi-speedometer2 me-2"></i>Agile Estimate</h3>
                            <p id="agileEstimate" class="result-value agile-value mb-0">-</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded-3 h-100">
                            <h3 class="h6 text-muted mb-2"><i class="bi bi-water me-2"></i>Waterfall Estimate</h3>
                            <p id="waterfallEstimate" class="result-value waterfall-value mb-0">-</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="accordion" id="rawResponseAccordion">
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    <i class="bi bi-code-square me-2"></i>View Raw AI Response
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne">
                                <div class="accordion-body p-3 bg-light rounded-3">
                                    <pre id="rawOlamaResponse" class="mb-0 p-3 bg-white rounded-2" style="font-size: 0.8rem;"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="card">
            <div class="card-header d-flex align-items-center">
                <i class="bi bi-clock-history me-2"></i>
                <h2 class="h5 mb-0">Estimation History</h2>
            </div>
            <div class="card-body">
                <div id="historyList" class="list-group list-group-flush">
                    <div class="text-center py-4 text-muted">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        Loading history...
                    </div>
                </div>
                <p id="noHistoryMessage" class="text-center text-muted py-4 d-none">No past estimates found.</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const estimationForm = document.getElementById('estimationForm');
        const resultsDiv = document.getElementById('results');
        const resultProjectName = document.getElementById('resultProjectName');
        const costEstimate = document.getElementById('costEstimate');
        const agileEstimate = document.getElementById('agileEstimate');
        const waterfallEstimate = document.getElementById('waterfallEstimate');
        const rawOlamaResponse = document.getElementById('rawOlamaResponse');
        const loadingMessage = document.getElementById('loadingMessage');
        const historyList = document.getElementById('historyList');
        const noHistoryMessage = document.getElementById('noHistoryMessage');

        const API_BASE_URL = window.location.origin;

        // Function to fetch and display history
        async function fetchHistory() {
            historyList.innerHTML = `
                <div class="text-center py-4 text-muted">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    Loading history...
                </div>
            `;
            noHistoryMessage.classList.add('d-none');

            try {
                const response = await fetch(`${API_BASE_URL}/history`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const history = await response.json();

                if (history.length === 0) {
                    noHistoryMessage.classList.remove('d-none');
                    historyList.innerHTML = '';
                    return;
                }

                historyList.innerHTML = '';
                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'list-group-item history-item py-3';
                    historyItem.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1 text-primary">${item.projectName}</h5>
                            <small class="text-muted">${new Date(item.timestamp).toLocaleString()}</small>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <small class="text-muted">Cost:</small>
                                <p class="mb-0 cost-value">${item.costEstimate || 'N/A'}</p>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted">Agile:</small>
                                <p class="mb-0 agile-value">${item.agileEstimate || 'N/A'}</p>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted">Waterfall:</small>
                                <p class="mb-0 waterfall-value">${item.waterfallEstimate || 'N/A'}</p>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-link p-0 mt-2" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#history-${item._id}">
                            <small>View Details</small>
                        </button>
                        <div class="collapse" id="history-${item._id}">
                            <div class="mt-2 p-2 bg-light rounded">
                                <h6 class="text-muted mb-1">Requirements:</h6>
                                <p class="small mb-2">${item.requirements || 'N/A'}</p>
                                <h6 class="text-muted mb-1">AI Response:</h6>
                                <pre class="small mb-0 p-2 bg-white rounded">${item.olamaRawResponse || 'N/A'}</pre>
                            </div>
                        </div>
                    `;
                    historyList.appendChild(historyItem);
                });
            } catch (error) {
                console.error("Error fetching history:", error);
                historyList.innerHTML = `
                    <div class="alert alert-danger">
                        Failed to load history: ${error.message}
                    </div>
                `;
            }
        }

        // Handle form submission
        estimationForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            resultsDiv.classList.add('d-none');
            loadingMessage.classList.remove('d-none');
            
            const data = {
                projectName: document.getElementById('projectName').value,
                description: document.getElementById('description').value,
                features: document.getElementById('features').value,
                technologies: document.getElementById('technologies').value,
                notes: document.getElementById('notes').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/estimate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();

                // Display results
                resultProjectName.textContent = result.projectName;
                costEstimate.textContent = result.costEstimate || 'N/A';
                agileEstimate.textContent = result.agileEstimate || 'N/A';
                waterfallEstimate.textContent = result.waterfallEstimate || 'N/A';
                rawOlamaResponse.textContent = result.olamaRawResponse || 'No raw response available';

                resultsDiv.classList.remove('d-none');
                loadingMessage.classList.add('d-none');
                fetchHistory();

                // Scroll to results
                resultsDiv.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error("Error getting estimate:", error);
                loadingMessage.classList.add('d-none');
                resultsDiv.classList.remove('d-none');
                
                resultProjectName.textContent = 'Error';
                costEstimate.textContent = `Error: ${error.message}`;
                agileEstimate.textContent = '';
                waterfallEstimate.textContent = '';
                rawOlamaResponse.textContent = 'Could not get response from AI. Check your backend server and AI setup.';
            }
        });

        // Fetch history when the page loads
        document.addEventListener('DOMContentLoaded', fetchHistory);
    </script>
</body>
</html>
